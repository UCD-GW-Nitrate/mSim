
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>2D transport simulation - Example 1</title><meta name="generator" content="MATLAB 8.4"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-09-01"><meta name="DC.source" content="transp_2D_ex01.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>2D transport simulation - Example 1</h1><!--introduction--><p><a href="msim_help_main.html">| main</a>   <a href="msim_help_demos.html">| Tutorials</a> <a href="msim_function_categories.html">| Functions</a> <a href="http://www.subsurface.gr">| website</a> |</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#3">Problem definition and mesh generation</a></li><li><a href="#10">Flow simulation</a></li></ul></div><p>In this tutorial we will first demonstrate the 2D transport over a 2D steady state groundwater flow domain. We will go through the steps of solving steady state groundwater flow without great detail as there are already other tutorials that cover that in depth.</p><p>The focus of this tutorial is the transport simulation</p><h2>Problem definition and mesh generation<a name="3"></a></h2><p>We will consider an orthogonal domain with dimensions 2x1 km. We will also assume that the domain is bounded left and right by constant head boundaries, 30 and 50 m respectively, while the top and bottom boundaries are no flow. In the modeling domain there are several wells. Last to keep things simple we will assume homogenous hydraulic conductivity and uniform recharge.</p><p>First we describe the geometric features which are:</p><p>the polygon domain</p><pre class="codeinput">domain.Geometry = <span class="string">'Polygon'</span>;
domain.X = [0 2000 2000 0 0 nan];
domain.Y = [0 0 1000 1000 0 nan];
</pre><p>and the wells</p><pre class="codeinput">w = [339,777,0.08; 1896,660,0.12; 1615,459,0.13; 1247,570,0.04;
    1136,308,0.15; 684,232,0.13;735,494,0.11;1044,806,0.08;1325,488,0.09;
    721,570,0.07];
<span class="keyword">for</span> ii = 1:size(w,1)
    wells(ii,1).Geometry = <span class="string">'Point'</span>;
    wells(ii,1).X = w(ii,1);
    wells(ii,1).Y = w(ii,2);
    wells(ii,1).DistMin = 5;
    wells(ii,1).DistMax = 100;
    wells(ii,1).LcMin = 5;
    wells(ii,1).LcMax = 50;
<span class="keyword">end</span>
</pre><p>We can now generate the mesh following the standard procedure as described in the relevant <a href="mesh_gen_main.html">tutorials</a>.</p><pre class="codeinput">rect_dom = CSGobj_v2(2,1,10,10,1);
rect_dom = rect_dom.readshapefile(domain);
rect_dom = rect_dom.readshapefile(wells);

<span class="comment">% define the global mesh options</span>
meshopt = msim_mesh_options;
meshopt.lc_gen = 150;
meshopt.embed_points = 1;

<span class="comment">% execute gmsh to generate the mesh</span>
rect_dom.writegeo(<span class="string">'transp_ex1'</span>, meshopt);
gmsh_path = <span class="string">'C:\Users\giorgk\Downloads\gmsh-4.4.1-Windows64\gmsh-4.4.1-Windows64\gmsh.exe'</span>;
rect_dom.runGmsh(<span class="string">'transp_ex1'</span>, gmsh_path, []);
</pre><pre class="codeoutput">Info    : Running 'C:\Users\giorgk\Downloads\gmsh-4.4.1-Windows64\gmsh-4.4.1-Windows64\gmsh.exe transp_ex1.geo -2' [Gmsh 4.4.1, 1 node, max. 1 thread]
Info    : Started on Sun Sep 01 17:43:28 2019
Info    : Reading 'transp_ex1.geo'...
Info    : Done reading 'transp_ex1.geo'
Info    : Meshing 1D...
Info    : Meshing curve 1 (Line)
Info    : Meshing curve 2 (Line)
Info    : Meshing curve 3 (Line)
Info    : Meshing curve 4 (Line)
Info    : Done meshing 1D (0 s)
Info    : Meshing 2D...
Info    : Meshing surface 1 (Plane, Delaunay)
Info    : Done meshing 2D (0.0625 s)
Info    : 1768 vertices 3548 elements
Info    : Writing 'transp_ex1.msh'...
Info    : Done writing 'transp_ex1.msh'
Info    : Stopped on Sun Sep 01 17:43:28 2019
</pre><p>read the mesh into matlab workspace</p><pre class="codeinput">[p, MSH]=read_2D_Gmsh(<span class="string">'transp_ex1'</span>, 0, 0);
Nel = size(MSH(3,1).elem(1,1).id, 1);
Np = size(p, 1);
triplot(MSH(3,1).elem(1,1).id, p(:,1), p(:,2))
axis <span class="string">equal</span>
axis([0 2000 0 1000])
</pre><pre class="codeoutput">Reading points...
Reading Elements...
</pre><img vspace="5" hspace="5" src="transp_2D_ex01_01.png" alt=""> <h2>Flow simulation<a name="10"></a></h2><p>With the discretized domain at hand we can move on to the flow simulation.</p><p><b>Boundary conditions</b></p><p>The domain has constant head left and right. First we identify the ids of the nodes that correspon to the boundary conditions and prepare the variable CH as follows:</p><pre class="codeinput">id_left = find(p(:,1) &lt; 0.1);
id_right = find(p(:,1) &gt; domain.X(2) - 0.1);
CH = [id_left 30*ones(length(id_left),1);
      id_right 50*ones(length(id_right),1)];
</pre><p><b>Well Fluxes</b></p><pre class="codeinput">Total_pumping = -5000;
Well_fluxes = nan(length(wells),2);
<span class="keyword">for</span> ii = 1:size(wells,1)
    [~, id] = min(sqrt((wells(ii,1).X - p(:,1)).^2+(wells(ii,1).Y - p(:,2)).^2));
    Well_fluxes(ii,:)=[id Total_pumping*w(ii,3)];
<span class="keyword">end</span>
</pre><p><b>Transmissivity</b></p><p>The transmissivity is uniform and we are going to define it on the elements</p><pre class="codeinput">Tel=20*ones(Nel,1)*10; <span class="comment">%m^2/day</span>
</pre><p><b>Assemble matrices</b></p><pre class="codeinput">simopt.dim = 2;
simopt.el_type = <span class="string">'triangle'</span>;
simopt.el_order = <span class="string">'linear'</span>;
[Kglo, H]= Assemble_LHS(p, MSH(3,1).elem(1,1).id, Tel , CH, [], simopt);
</pre><p>Convert the well fluxes to sparse matrix which are the only fluxes in our hypothetical example</p><pre class="codeinput">F = sparse(Well_fluxes(:,1),1,Well_fluxes(:,2),length(H),1);
</pre><p><b>solve</b></p><pre class="codeinput">H = solve_system(Kglo,H,F);
</pre><p><b>visualize</b></p><pre class="codeinput">clf
trisurf(MSH(3,1).elem(1,1).id,p(:,1),p(:,2),H)
view(-18,2)
</pre><img vspace="5" hspace="5" src="transp_2D_ex01_02.png" alt=""> <p><a href="msim_help_main.html">| main</a>   <a href="msim_help_demos.html">| Tutorials</a> <a href="msim_function_categories.html">| Functions</a> <a href="http://www.subsurface.gr">| website</a> |</p><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2014b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% 2D transport simulation - Example 1
% <msim_help_main.html | main>   <msim_help_demos.html | Tutorials> 
% <msim_function_categories.html | Functions> <http://www.subsurface.gr | website> |
%%
% In this tutorial we will first demonstrate the 2D transport over a 
% 2D steady state groundwater flow domain. We will go through the steps of 
% solving steady state groundwater flow without great detail as there are
% already other tutorials that cover that in depth. 
%%% 
% The focus of this tutorial is the transport simulation
%% Problem definition and mesh generation
% We will consider an orthogonal domain with dimensions 2x1 km. We will
% also assume that the domain is bounded left and right by constant head
% boundaries, 30 and 50 m respectively, while the top and bottom boundaries are no flow. In the
% modeling domain there are several wells. Last to keep things simple we
% will assume homogenous hydraulic conductivity and uniform recharge.
%%%
% First we describe the geometric features which are:
%%%
% the polygon domain
domain.Geometry = 'Polygon';
domain.X = [0 2000 2000 0 0 nan];
domain.Y = [0 0 1000 1000 0 nan];
%%%
% and the wells
%%%
w = [339,777,0.08; 1896,660,0.12; 1615,459,0.13; 1247,570,0.04; 
    1136,308,0.15; 684,232,0.13;735,494,0.11;1044,806,0.08;1325,488,0.09;
    721,570,0.07];
for ii = 1:size(w,1)
    wells(ii,1).Geometry = 'Point';
    wells(ii,1).X = w(ii,1);
    wells(ii,1).Y = w(ii,2);
    wells(ii,1).DistMin = 5;
    wells(ii,1).DistMax = 100;
    wells(ii,1).LcMin = 5;
    wells(ii,1).LcMax = 50;
end
%%%
% We can now generate the mesh following the standard procedure as described 
% in the relevant <mesh_gen_main.html tutorials>. 
rect_dom = CSGobj_v2(2,1,10,10,1);
rect_dom = rect_dom.readshapefile(domain);
rect_dom = rect_dom.readshapefile(wells);

% define the global mesh options
meshopt = msim_mesh_options;
meshopt.lc_gen = 150;
meshopt.embed_points = 1;

% execute gmsh to generate the mesh
rect_dom.writegeo('transp_ex1', meshopt);
gmsh_path = 'C:\Users\giorgk\Downloads\gmsh-4.4.1-Windows64\gmsh-4.4.1-Windows64\gmsh.exe';
rect_dom.runGmsh('transp_ex1', gmsh_path, []);
%%
% read the mesh into matlab workspace
[p, MSH]=read_2D_Gmsh('transp_ex1', 0, 0);
Nel = size(MSH(3,1).elem(1,1).id, 1);
Np = size(p, 1);
triplot(MSH(3,1).elem(1,1).id, p(:,1), p(:,2))
axis equal
axis([0 2000 0 1000])
%% Flow simulation
% With the discretized domain at hand we can move on to the flow
% simulation.
%%% 
% *Boundary conditions*
%
% The domain has constant head left and right. First we identify the ids of
% the nodes that correspon to the boundary conditions and prepare the
% variable CH as follows:
id_left = find(p(:,1) < 0.1);
id_right = find(p(:,1) > domain.X(2) - 0.1);
CH = [id_left 30*ones(length(id_left),1);
      id_right 50*ones(length(id_right),1)];
%%%
% *Well Fluxes*
Total_pumping = -5000;
Well_fluxes = nan(length(wells),2);
for ii = 1:size(wells,1)
    [~, id] = min(sqrt((wells(ii,1).X - p(:,1)).^2+(wells(ii,1).Y - p(:,2)).^2));
    Well_fluxes(ii,:)=[id Total_pumping*w(ii,3)];
end
%%%
% *Transmissivity*
% 
% The transmissivity is uniform and we are going to define it on the
% elements
Tel=20*ones(Nel,1)*10; %m^2/day
%%%
% *Assemble matrices*
simopt.dim = 2;
simopt.el_type = 'triangle';
simopt.el_order = 'linear';
[Kglo, H]= Assemble_LHS(p, MSH(3,1).elem(1,1).id, Tel , CH, [], simopt);
%%%
% Convert the well fluxes to sparse matrix which are the only fluxes in our
% hypothetical example
F = sparse(Well_fluxes(:,1),1,Well_fluxes(:,2),length(H),1);
%%%
% *solve*
H = solve_system(Kglo,H,F);
%%%
% *visualize*
clf
trisurf(MSH(3,1).elem(1,1).id,p(:,1),p(:,2),H)
view(-18,2)
%%
% 
% <msim_help_main.html | main>   <msim_help_demos.html | Tutorials> 
% <msim_function_categories.html | Functions> <http://www.subsurface.gr | website> |
%
##### SOURCE END #####
--></body></html>