
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Transport simulation in 1D</title><meta name="generator" content="MATLAB 8.1"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2016-04-06"><meta name="DC.source" content="transp_1D_std.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, tt, code { font-size:12px; }
pre { margin:0px 0px 20px; }
pre.error { color:red; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Transport simulation in 1D</h1><!--introduction--><p><a href="msim_help_main.html">| main</a>   <a href="msim_help_demos.html">| Tutorials</a> <a href="msim_function_categories.html">| Functions</a> <a href="http://www.subsurface.gr">| website</a> |</p><p>In this example we show how to use msim functions to solve 1D ADE. This is very important in streamline modeling that msim was developed for. Besides showing the msim function we perform a small analysis on the parameters of the ADE.</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Problem Description</a></li><li><a href="#10">Constant transport parameters, no decay, no retardation</a></li></ul></div><h2>Problem Description<a name="1"></a></h2><p>The domain of the problem is a line 5 km long.</p><pre class="codeinput">L = 5000;
</pre><p>We will discretize the domain into 50 m linear line elements. Therefore the coordinates of the points are</p><pre class="codeinput">p = ( 0:50:L )';
Np = size(p, 1);
</pre><p>Next we define the 1D mesh. To generate a uniform 1D mesh we do not need any special software, however we need to create a structure variable to hold the mesh information, similar to the one we use in more complex meshes. The first 2 lines of code are not used and descibe the 0 dimension elements e.g. boundary points. (We could set MSH(1,1) = []; instead)</p><pre class="codeinput">MSH(1,1).elem(1,1).type = <span class="string">'Bndpnt'</span>;
MSH(1,1).elem(1,1).id = [1;Np];
MSH(2,1).elem(1,1).type = <span class="string">'line'</span>;
MSH(2,1).elem(1,1).id = [(1:Np-1)' (2:Np)'];
Nel = size(MSH(2,1).elem(1,1).id,1);
</pre><p>For initial conditions we will use a constant concentration of of 50 mg/L on the first node with id 1</p><pre class="codeinput">CC = [1 50];
</pre><p>The initial distribution of the concentration will be zero</p><pre class="codeinput">Cinit = zeros(Np, 1);
</pre><p>and we will run the simulation for 150 years with yearly step</p><pre class="codeinput">T = (0:150)'*365;
</pre><p>Since we do not have any input/output flows we set a vector of zeros</p><pre class="codeinput">F = sparse(Np,1);
</pre><p>and we will use the crank Niclolson scheme</p><pre class="codeinput">wmega = 0.5;
</pre><p>Last we will define the few simulation options</p><pre class="codeinput">opt.dim=1; <span class="comment">% This is the dimension of the problem</span>
opt.el_type=<span class="string">'line'</span>; <span class="comment">%the element type</span>
opt.el_order=<span class="string">'linear'</span>;<span class="comment">% the element order (linear is the only valid option)</span>
opt.assemblemode=<span class="string">'vect'</span>;<span class="comment">% theis is the mode. (use always vectorized option)</span>
opt.capacmode=<span class="string">'consistent'</span>;<span class="comment">% option regarding the capacitance matrix (other option is 'lumped')</span>
</pre><h2>Constant transport parameters, no decay, no retardation<a name="10"></a></h2><p>First we will show the most simple transport case where all transport properties constant. In addition we will assume no retardation and decay.</p><pre class="codeinput">aL = 500; <span class="comment">%[m] longitudinal dispersivity</span>
v = 0.15; <span class="comment">%[m/day] velocity</span>
lambda = 0; <span class="comment">%[1/day] radioactive decay</span>
K_d = 0; <span class="comment">%[m^3/Kg] equilibrium distribution coefficient</span>
rho_b = 1;<span class="comment">% bulk density</span>
Dm = 1.1578e-004;<span class="comment">%[m^2/day] Molecular diffusion coefficient</span>
theta = ones(Nel,1);
</pre><p>To assemble the mass and dispersivity matrix we call the function</p><pre class="codeinput">[Dglo, Mglo, c]= Assemble_LHS_std(p, MSH(2,1).elem(1,1).id,<span class="keyword">...</span>
    aL, v, rho_b, K_d, lambda, theta, Dm, CC, opt);
</pre><p>... and we are ready to solve the transport equation</p><pre class="codeinput">C1 = SteadyFlowTransport(Mglo, Dglo, F, Cinit, T, c, wmega);
</pre><p>Plotting concentration profiles and the breakthrough curve at the outlet in matlab is easy</p><pre class="codeinput">figure(<span class="string">'Position'</span>,[100 100 660 220])
subplot(1,2,1);
surf(p/1000,T(2:end)/365,C1,<span class="string">'edgecolor'</span>,<span class="string">'none'</span>)
view(0,90)
axis([0 5 0 150])
xlabel(<span class="string">'Distance [km]'</span>)
ylabel(<span class="string">'Time [years]'</span>)
colorbar
subplot(1,2,2)
plot(T(2:end)/365,C1(:,end))
xlabel(<span class="string">'Time [years]'</span>)
ylabel(<span class="string">'Concentration at the outlet [mg/L]'</span>)
</pre><img vspace="5" hspace="5" src="transp_1D_std_01.png" alt=""> <p><a href="msim_help_main.html">| main</a>   <a href="msim_help_demos.html">| Tutorials</a> <a href="msim_function_categories.html">| Functions</a> <a href="http://www.subsurface.gr">| website</a> |</p><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2013a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Transport simulation in 1D
% <msim_help_main.html | main>   <msim_help_demos.html | Tutorials> 
% <msim_function_categories.html | Functions> <http://www.subsurface.gr | website> |
%
% In this example we show how to use msim functions to solve 1D ADE. This
% is very important in streamline modeling that msim was developed for.
% Besides showing the msim function we perform a small analysis on the
% parameters of the ADE.
%% Problem Description
% The domain of the problem is a line 5 km long.
L = 5000;
%%
% We will discretize the domain into 50 m linear line elements. 
% Therefore the coordinates of the points are
p = ( 0:50:L )';
Np = size(p, 1);
%%
% Next we define the 1D mesh. To generate a uniform 1D mesh we do not need 
% any special software, however we need to create a structure variable to 
% hold the mesh information, similar to the one we use in more complex 
% meshes. The first 2 lines of code are not used and descibe the 0 
% dimension elements e.g. boundary points. (We could set MSH(1,1) = []; instead)
MSH(1,1).elem(1,1).type = 'Bndpnt';
MSH(1,1).elem(1,1).id = [1;Np];
MSH(2,1).elem(1,1).type = 'line';
MSH(2,1).elem(1,1).id = [(1:Np-1)' (2:Np)'];
Nel = size(MSH(2,1).elem(1,1).id,1);
%%
% For initial conditions we will use a constant concentration of of 50 mg/L
% on the first node with id 1
CC = [1 50];
%%
% The initial distribution of the concentration will be zero
Cinit = zeros(Np, 1);
%%
% and we will run the simulation for 150 years with yearly step
T = (0:150)'*365;
%%
% Since we do not have any input/output flows we set a vector of zeros
F = sparse(Np,1);
%%
% and we will use the crank Niclolson scheme
wmega = 0.5;
%%
% Last we will define the few simulation options
opt.dim=1; % This is the dimension of the problem
opt.el_type='line'; %the element type
opt.el_order='linear';% the element order (linear is the only valid option)
opt.assemblemode='vect';% theis is the mode. (use always vectorized option)
opt.capacmode='consistent';% option regarding the capacitance matrix (other option is 'lumped')
%% Constant transport parameters, no decay, no retardation
% First we will show the most simple transport case where all transport 
% properties constant. In addition we will assume no retardation and decay.
aL = 500; %[m] longitudinal dispersivity
v = 0.15; %[m/day] velocity
lambda = 0; %[1/day] radioactive decay
K_d = 0; %[m^3/Kg] equilibrium distribution coefficient
rho_b = 1;% bulk density
Dm = 1.1578e-004;%[m^2/day] Molecular diffusion coefficient
theta = ones(Nel,1);
%%
% To assemble the mass and dispersivity matrix we call the function
[Dglo, Mglo, c]= Assemble_LHS_std(p, MSH(2,1).elem(1,1).id,...
    aL, v, rho_b, K_d, lambda, theta, Dm, CC, opt);
%%
% ... and we are ready to solve the transport equation
C1 = SteadyFlowTransport(Mglo, Dglo, F, Cinit, T, c, wmega);
%%
% Plotting concentration profiles and the breakthrough curve at the outlet in matlab is easy
figure('Position',[100 100 660 220])
subplot(1,2,1);
surf(p/1000,T(2:end)/365,C1,'edgecolor','none')
view(0,90)
axis([0 5 0 150])
xlabel('Distance [km]')
ylabel('Time [years]')
colorbar
subplot(1,2,2)
plot(T(2:end)/365,C1(:,end))
xlabel('Time [years]')
ylabel('Concentration at the outlet [mg/L]')
%%
% 
% <msim_help_main.html | main>   <msim_help_demos.html | Tutorials> 
% <msim_function_categories.html | Functions> <http://www.subsurface.gr | website> |
%
##### SOURCE END #####
--></body></html>